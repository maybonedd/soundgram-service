

# SOUNDGRAM — Yandex Music Playlist Extractor

Микросервис на **FastAPI**, предназначенный для извлечения и нормализации данных о плейлистах Яндекс Музыки. Сервис поддерживает старый и новый форматы ссылок, извлекает информацию о треках и возвращает структурированные данные.

## Структура проекта

* `app/main.py` — Точка входа, настройка путей и эндпоинты API.
* `app/clients/yandex.py` — Асинхронный клиент для взаимодействия с внешним API.
* `app/schemas/playlist.py` — Pydantic-модели (схемы) для валидации ответов.
* `app/core/utils.py` — Регулярные выражения для парсинга ссылок и форматирование данных.

---

## Запуск

### С использованием venv:

1. Клонируйте репозиторий.
2. Создайте виртуальное окружение:

```bash
python -m venv venv
source venv/bin/activate  # Для Windows: venv\Scripts\activate

```

3. Установите зависимости:

```bash
pip install -r requirements.txt

```

4. Запустите сервис:

```bash
uvicorn app.main:app --reload

```

5. Откройте Swagger UI: `http://127.0.0.1:8000/docs`

---

## Описание API

### `GET /api/v1/playlist`

Извлекает данные о плейлисте по его URL.

**Параметры:**

* `url` (string, required): Ссылка на плейлист.

**Пример ответа:**

```json
{
  "title": "Плейлист дня",
  "owner": "yandex_music",
  "tracks": [
    {
      "id": "123456",
      "title": "Название трека",
      "artist": "Имя артиста",
      "duration_ms": 180000
    }
  ]
}

```

---

## Assumptions & Edge cases (Допущения и краевые случаи)

### Поддерживаемые форматы

Сервис поддерживает 4 основных типа ссылок:

1. **Новый формат (UUID):** `music.yandex.ru/playlists/lk.430fc091-...`
2. **Новый формат «Мне нравится»:** `music.yandex.ru/playlists/likes`
3. **Старый формат (User ID):** `music.yandex.ru/users/{owner}/playlists/{kind}`
4. **Старый формат «Мне нравится»:** `music.yandex.ru/users/{owner}/playlists/3`

### Обработка ошибок и авторизация

* **Публичные данные:** Плейлисты нового формата (включая UUID) и стандартные публичные подборки обрабатываются **без авторизации** (cookie и сессии не требуются).
* **Приватность:** Для доступа к приватным плейлистам «Мне нравится» (если они скрыты настройками профиля) необходимо установить `YANDEX_TOKEN` в переменные окружения.
* **404 / Доступ:** Если плейлист удален или недоступен, сервис возвращает ошибку с описанием.
* **Таймауты:** Установлен лимит на ожидание ответа от API Яндекса.
* **User-Agent:** Используются заголовки реального браузера для предотвращения блокировок (анти-бот).

### "Неофициальные" моменты

* Используются внутренние эндпоинты `api.music.yandex.by` с параметром `richtracks=true`, что позволяет получать полные данные о треках за один запрос.
* Логика парсинга изолирована в `YandexMusicClient`.

---

## Примеры использования

### Стабильные запросы

Поддерживаются ссылки на любые публичные или системные плейлисты.

* **UUID ссылка:** `https://music.yandex.ru/playlists/lk.430fc091-4c7d-4956-882a-40090f9a7487`
* **Лайки (новый вид):** `https://music.yandex.ru/playlists/likes`
* **Классическая ссылка:** `https://music.yandex.ru/users/yamusic-daily/playlists/1060`

### Особенности UUID-ссылок

Вопреки ранним ограничениям, текущая версия MVP успешно обрабатывает UUID-ссылки без использования пользовательских сессий, так как эндпоинт API Яндекса предоставляет данные в открытом виде для публичных объектов.

---
